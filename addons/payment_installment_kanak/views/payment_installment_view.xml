<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record model="ir.ui.view" id="account_installment_view">
        <field name="name">Invoice Installment Line</field>
        <field name="model">invoice.installment.line</field>
        <field name="arch" type="xml">
            <tree string="Invoice Installment Line">
                <field name="index"/>
                <field name="interest_rate"/>
                <field name="total_remaining_amount"/>
                <field name="without_interest_amount" sum="Total Principle Amount"/>
                <field name="interest_amount" sum="Total Interest Amount"/>
                <field name="due_amount" sum="Total Due Amount"/>
                <field name="each_period_ar_amount" sum="Total AR Amount"/>
                <field name="amount" sum="Total Amount"/>
                <field name="paid_amount" sum="Total Paid Amount"/>
                <field name="fine_amount" sum="Total Fine Amount"/>
                <field name="payment_date"/>
                <field name="description"/>
                <field name="state"/>
                <button name="action_register_payment" type="object" icon="fa-check" string="Make Payment"/>
                <!-- <button name="print_invoice" type="object" icon="fa-print" string="Print" /> -->
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_move_form_installment">
        <field name="name">account.move.form.installment</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='journal_id']" position="after">
                <field name="sale_installment" invisible="1"/>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <!--                <page string="Installments" name="installments" groups="payment_installment_kanak.group_enable_installments">-->

                <!--                <page string="Installments" name="installments" groups="payment_installment_kanak.group_enable_installments">-->
                <page string="Installments" name="installments"
                      attrs="{'invisible': ['|',('move_type', 'in', ['in_invoice','in_refund','entry']),('service_type', '=', True)]}">
                    <!-- <button name="%(payment_installment_kanak.action_sub_part_payment_confirm)d" string="Part Payment" type="action" context='{"default_move_id": active_id}' class="oe_highlight" style="border-color: #2196F3; margin-left: 10px !important;"/> -->
                    <group col="3">
                        <group>
                            <field name="tenure_amount_untaxed" readonly="1"/>
                            <field name="tenure_amount_tax" readonly="1"/>
                            <field name="tenure_amt" readonly="1"/>
                            <label for="tenure"/>
                            <div class="o_row" name="Tenure">
                                <field name="tenure" class="oe_inline" readonly="1"/>
                                <field name="tenure_type" nolabel="1" class="oe_inline" style="margin-left:5px"
                                       readonly="1"/>
                            </div>
                            <label for="fine_threshold"/>
                            <div class="o_row" name="fine_threshold">
                                <field name="fine_threshold" class="oe_inline" readonly="1"/>
                                <span>Days</span>
                            </div>

                        </group>
                        <group>
                            <field name="payment_circle_count" readonly="1"/>
                            <field name="down_payment_type" readonly="1"/>
                            <field name="down_payment_percent" attrs="{'invisible':[('down_payment_type','=','fix')]}"
                                   readonly="1"/>
                            <field name="down_payment_fixed" attrs="{'invisible':[('down_payment_type','=','percent')]}"
                                   readonly="1"/>
                            <field name="down_payment_amt" readonly="1"/>
                        </group>
                        <group>
                            <field name="payable_amt" readonly="1"/>
                            <field name="installment_amt" readonly="1"/>
                            <field name="interest_rate" readonly="1"/>
                            <field name="fine_rate" readonly="1"/>
                            <field name="start_invoice_date" readonly="1"/>
                            <field name="contract_date" readonly="1"/>
                            <field name="payment_term_date"/>
                        </group>

                    </group>
                    <field name="installment_ids" attrs="{'invisible':[('service_type', '=', True)]}">
                        <tree editable="bottom" string="Installments" create="0" edit="0">
                            <button string="View" name="open_line_form" icon="fa-bars" type="object" optional="hide"
                                    groups="base.group_no_one"/>
                            <button string="Open" name="open_line_form" icon="fa-bars" type="object" optional="hide"
                                    groups="base.group_no_one"/>
                            <!-- <button string="Open" name="open_line_form" icon="fa-bars" type="object" optional="hide"
                                    groups="base.group_no_one"/> -->
                            <field name="is_active" invisible="1"></field>
                            <field name="invoice_currency_id" invisible="1"/>
                            <field name="paid_currency_id" invisible="1"/>
                            <field name="index" optional="hide"/>
                            <field name="payment_start_date"/>
                            <field name="payment_end_date"/>
                            <field name="payment_date" string="Due Date" optional="show"/>
                            <field name="description" string="Particular" optional="show"/>
                            <field name="interest_rate" string="Rate"/>
                            <field name="total_remaining_amount" string="Principal Beginning" optional="show"/>
                            <field name="without_interest_amount" string="Principal Amount" sum="Total Principal Amount"
                                   optional="show"/>
                            <field name="interest_amount" sum="Total Interest Amount" optional="show"/>
                            <field name="each_period_ar_amount" sum="Total Ar Amount" string="Principal Balance"
                                   optional="show"/>
                            <field name="due_amount" sum="Total Due Amount"/>
                            <field name="fine_rate" optional="hide"/>
                            <field name="fine_current_period"/>
                            <field name="fine_previous_period"/>
                            <field name="fine_amount" sum="Total Fine Amount" string="Total Fine" optional="show"/>
                            <field name="fine_discount" sum="Total Fine Discount" string="Fine Discount"
                                   optional="show"/>
                            <field name="fine_discount_approval"/>
                            <field name="interest_discount" sum="Total Interest Discount" string="Interest Discount"
                                   optional="show"/>
                            <field name="interest_discount_approval"/>

                            <field name="amount" sum="Total Amount" widget="monetary"
                                   options="{'currency_field':'invoice_currency_id'}"/>
                            <field name="paid_amount" sum="Total Paid Amount" widget="monetary"
                                   string="Paid Amount"/>
                            <field name="partial_paid_amount" sum="Total Paid Amount" invisible="1"/>
                            <field name="rv_date"/>
                            <field name="rv_no"/>
                            <field name="fine_paid" sum="Total Fine Paid" widget="monetary"
                            />
                            <field name="principal_paid" sum="Total Principal Paid" widget="monetary"
                            />
                            <field name="ar_balance_previous" invisible="1"/>
                            <field name="ar_balance" widget="monetary"
                                   options="{'currency_field':'invoice_currency_id'}"/>
                            <field name="state"/>
                            <field name="paid" invisible="1"/>
                            <button name="action_register_payment" type="object" icon="fa-check" string="Make Payment"
                                    attrs="{'invisible': [('state','not in', ['current_due','draft'])]}"/>
                            <!-- <button name="print_invoice" type="object" icon="fa-print" string="Print" attrs="{'invisible':[('state','!=','paid')]}"/> -->
                            <!--                            <button name="installment_fine_tester" type="object" string="Installment Fine Tester"-->
                            <!--                                    icon="fa-refresh" invisible="1"/>-->
                            <button name="action_rv_numbers" type="object" string="RV Numbers" icon="fa-refresh"
                                    attrs="{'invisible': [('rv_no','=',False)]}"/>

                            <button name="action_fine_discount_cfd_approved" type="object"
                                    string="Fine Discount CFD Approved" icon="fa-refresh"
                                    groups="master_data_extension.group_cfd_user"
                                    attrs="{'invisible':['!','&amp;',('fine_discount_approval','=','draft'),('state','=','current_due')]}"
                            />
                            <button name="action_interest_discount_cfd_approved" type="object"
                                    string="Interest Discount CFD Approved" icon="fa-refresh"
                                    groups="master_data_extension.group_cfd_user"
                                    attrs="{'invisible':['!','&amp;',('interest_discount_approval','=','draft'),('state','=','current_due')]}"
                            />
                            <!--                            <button name="skip_payment" type="object" icon="fa-remove" string="Skip Payment"-->
                            <!--                                    attrs="{'invisible': [('state','!=', 'current_due')]}"/>-->
                            <!-- <field name="invoice_currency_id" invisible="1"/>
                            <field name="paid_currency_id" invisible="1"/>
                            <field name="index" optional="hide"/>
                            <field name="payment_date" string="Due Date" optional="show"/>/
                            <field name="total_remaining_amount" string="Principal Beginning" optional="show"/>
                            <field name="without_interest_amount" string="Principal Amount" sum="Total Principal Amount" optional="show"/>
                            <field name="due_amount" sum="Total Due Amount"/>
                            <field name="fine_rate" optional="hide"/>
                            <field name="amount" sum="Total Amount" widget="monetary" options="{'currency_field':'invoice_currency_id'}"/>
                            <field name="paid_amount" sum="Total Paid Amount" widget="monetary" />
                            <field name="principal_paid" sum="Total Principal Paid" widget="monetary" />
                            <field name="ar_balance_previous" invisible="1"/>
                            <field name="ar_balance" widget="monetary" options="{'currency_field':'invoice_currency_id'}"/>
                            <field name="state"/>
                            <field name="paid" invisible="1"/>
                           <button name="action_register_payment" type="object" icon="fa-check" string="Make Payment" attrs="{'invisible': ['|', ('state','in', ['paid','skip']),('paid','=',True)]}"/>
                           <button name="print_invoice" type="object" icon="fa-print" string="Print" attrs="{'invisible':[('state','!=','paid')]}"/>
                           <button name="installment_fine_tester" type="object" string="Installment Fine Tester" icon="fa-refresh"/>
                           <button name="skip_payment" type="object" icon="fa-remove" string="Skip Payment" attrs="{'invisible': ['|', ('state','=', 'paid'),('state','=','skip')]}"/> -->
                        </tree>
                    </field>
                </page>
                <!-- <page name="installment_dev_view" string="DevView" default_focus="1">
                    <field name="installment_ids">
                        <tree string="Caption" create="0" delete="0" edit="true" editable="bottom">
                            <field name="amount" sum="Total Amount" widget="monetary" options="{'currency_field':'invoice_currency_id'}"/>
                            <field name="paid_amount" sum="Total Paid Amount" widget="monetary" />
                            <field name="partial_paid_amount" />
                        </tree>
                    </field>
                </page> -->
            </xpath>
        </field>
    </record>


    <record model="ir.ui.view" id="view_order_form_installment">
        <field name="name">sale.order.form.installment</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_quotation_send']" position="after">
                <button name="action_installment_modify" string="Modify Installment" type="object" states="draft"
                        class="btn-primary"/>
                <button name="action_recontract" string="Re-Contract" type="object"
                        class="btn-primary" attrs="{'invisible': [('invoice_status','!=','invoiced')]}"/>
            </xpath>
            <xpath expr="sheet/div/button[2]" position="after">
                <button name="action_view_recontract" type="object" class="oe_stat_button" icon="fa-pencil-square-o"
                        attrs="{'invisible': [('contract_count', '=', 0)]}">
                    <field name="contract_count" widget="statinfo" string="Re-Contract"/>
                </button>
            </xpath>
            <xpath expr="//field[@name='payment_term_id']" position="after">
                <field name="plan_branches" invisible="1"/>
                <field name="installment_plan_id" options="{'no_create': True}"
                       attrs="{'readonly':[('state','not in','draft')],'invisible':[('service_type','=',True)]}" domain="[('state','=','approved_finance')]"/>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <!--                <page string="Installments" name="installments" groups="payment_installment_kanak.group_enable_installments">-->
                <page string="Installments" name="installments" attrs="{'invisible':[('service_type', '=', True)]}">
                    <group col="3">
                        <group>
                            <field name="tenure_amount_untaxed"/>
                            <field name="tenure_amount_tax"/>
                            <field name="tenure_amt"/>
                            <label for="tenure"/>
                            <div class="o_row" name="Tenure">
                                <field name="tenure" class="oe_inline" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="tenure_type" nolabel="1"
                                       attrs="{'readonly':[('state','!=','draft')]}" class="oe_inline"
                                       style="margin-left:5px"/>
                            </div>
                            <label for="fine_threshold"/>
                            <div class="o_row" name="fine_threshold">
                                <field name="fine_threshold" attrs="{'readonly':[('state','!=','draft')]}"
                                       class="oe_inline"/>
                                <span>Days</span>
                            </div>

                        </group>
                        <group>
                            <field name="payment_circle_count"/>
                            <field name="down_payment_type"/>
                            <field name="down_payment_percent" attrs="{'invisible':[('down_payment_type','=','fix')]}"
                            />
                            <field name="down_payment_fixed" attrs="{'invisible':[('down_payment_type','=','percent')]}"
                            />
                            <field name="down_payment_amt"/>
                        </group>
                        <group>
                            <field name="payable_amt"/>
                            <field name="installment_amt"/>
                            <field name="interest_rate" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="fine_rate" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="start_invoice_date"/>
                            <field name="contract_date"/>
                        </group>
                    </group>
                    <field name="installment_ids"
                           attrs="{'readonly': [('invoice_status','=', 'invoiced'),('state','=','sale')]}">
                        <tree editable="bottom" string="Installments" create="0">
                            <field name="index" optional="hide"/>
                            <field name="payment_date" string="Due Date" optional="show"/>
                            <field name="description" string="Particular" optional="show"/>

                            <field name="interest_rate" string="Rate"/>
                            <field name="total_remaining_amount" string="Principal Beginning" optional="show"/>
                            <field name="without_interest_amount" sum="Total Principle Amount" string="Principal Amount"
                                   optional="show" widget="monetary"/>
                            <field name="interest_amount" sum="Total Interest Amount" optional="show"/>
                            <field name="each_period_ar_amount" sum="Total Ar Amount"
                                   string="Principal Balance" optional="show"/>
                            <field name="due_amount" sum="Total Due Amount"/>
                            <field name="fine_rate" optional="hide"/>
                            <field name="fine_current_period" sum="Fine Current Period" readonly="0"/>
                            <field name="fine_previous_period" sum="Fine Previous Period" readonly="0"/>
                            <field name="fine_amount" sum="Total Fine Amount" string="Total Fine"
                                   optional="show"/>
                            <field name="fine_discount" sum="Total Fine Discount" string="Fine Discount"
                                   optional="show"/>
                            <field name="interest_discount" sum="Total Interest Discount"
                                   string="Interest Discount" optional="show"/>
                            <field name="amount" sum="Total Amount"/>
                            <field name="rv_date"/>
                            <field name="rv_no"/>
                            <field name="paid_amount" sum="Total Paid Amount"/>
                            <field name="fine_paid" sum="Total Fine Paid"/>
                            <field name="principal_paid" sum="Total Principal Paid"/>
                            <field name="ar_balance_previous" invisible="1"/>
                            <field name="ar_balance" sum="Total AR Balance"/>
                            <field name="state"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

    <record id="invoice_installment_action" model="ir.actions.act_window">
        <field name="name">Invsale.installment.lineoice Installment</field>
        <field name="res_model">invoice.installment.line</field>
        <field name="view_mode">tree</field>
    </record>

    <menuitem name="Invoice Installment" id="invoice_installment" parent="sale.menu_sale_config"
              action="invoice_installment_action" sequence="90"/>

</odoo>
