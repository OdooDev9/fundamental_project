<odoo>
    <data>
        <record id="journal_picking_form" model="ir.ui.view">
            <field name="name">stock.picking</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header/field[@name='state']" position="replace">
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,assigned,approve_inv_head,approve_finance_head,approve_gm_agm,done" />
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_get_account_moves" icon="fa-usd"
                            attrs="{'invisible': [('state', 'not in', ['done'])]}" class="oe_stat_button"
                            string="Journal Entries" type="object"
                            groups="master_data_extension.group_hr_bu_manager,master_data_extension.group_hr_bu_user"/>
                </xpath>
                <xpath expr="//tree/field[@name='product_id']" position="after">
                    <field name="standard_price"
                           groups="master_data_extension.group_hr_bu_manager,master_data_extension.group_hr_bu_user"/>
                </xpath>
                <xpath expr="//field[@name='origin']" position="after">
                    <field name="is_validate" invisible="1"/>
                    <field name="show_validate" invisible="1"/>
                    <field name="is_bu" invisible="1"/>
                    <field name="is_br" invisible="1"/>
                </xpath>
                <xpath expr="//button[@name='button_validate'][1]" position="attributes">
                    <attribute name="attrs"></attribute>
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='button_validate'][2]" position="attributes">
                    <attribute name="attrs"></attribute>
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='action_confirm']" position="replace">
                    <button name="action_confirm"
                            attrs="{'invisible': ['|',('show_mark_as_todo', '=', False),('is_validate','=',False)]}"
                            string="Mark as Todo" type="object" class="oe_highlight" groups="base.group_user"
                            data-hotkey="x"/>
                </xpath>
                <xpath expr="//button[@name='action_confirm']" position="after">
                    <field name="bu_br_user_approve" invisible="1"/>
                    <!-- Issue  Part Approval Stage 1 By Inventory Head-->
                    <button name="action_approve_inv_head"
                            attrs="{'invisible': ['|','|','|',('bu_br_user_approve','=',False),('picking_type_code', '!=','outgoing'),('show_check_availability','!=',False),('state', 'not in', ('waiting','confirmed','assigned'))]}"
                            string="Approve By Inventory Head" type="object" class="oe_highlight"
                            groups="product_configure.group_inventory_head" data-hotkey="x"/>
                    <!-- Issue  Unit Approval Stage 2 By Finance And Account Head-->
                    <button name="action_approve_finance_head"
                            attrs="{'invisible': ['|','|','|',('bu_br_user_approve','=',False),('picking_type_code', '!=','outgoing'),('unit_or_part','!=','unit'),('state', '!=', ('approve_inv_head'))]}"
                            string="Approve By F &amp; A Head" type="object" class="oe_highlight"
                            groups="product_configure.group_finance_account_head" data-hotkey="x"/>
                    <!-- Issue  Unit Approval Stage3 By GM/AGM-->
                    <!-- <button name="action_approve_gm_agm" attrs="{'invisible': ['|','|',('picking_type_code', '!=','outgoing'),('unit_or_part','!=','unit'),('state', '!=', ('approve_finance_head'))]}" string="Approve By GM/AGM" type="object" class="oe_highlight" groups="product_configure.group_gm_agm" data-hotkey="x" /> -->
                    <!-- Receipt Unit or Part Approval Stage 1 By Inventory Head-->
                    <button name="action_approve_inv_head"
                            attrs="{'invisible': ['|','|',('bu_br_user_approve','=',False),('picking_type_code', '!=', 'incoming'),('state', 'not in', ('waiting','confirmed','assigned'))]}"
                            string="Approve By Inventory Head" type="object" class="oe_highlight"
                            groups="product_configure.group_inventory_head" data-hotkey="x"/>
                    <!--  Receipt Unit Approval Stage 2 By Finance And Account Head-->
                    <button name="action_approve_finance_head"
                            attrs="{'invisible': ['|','|','|','|',('bu_br_user_approve','=',False),('is_return','=',True),('picking_type_code', '!=', 'incoming'),('unit_or_part','!=','unit'),('state', '!=', 'approve_inv_head')]}"
                            string="Approve By F &amp; A Head" type="object" class="oe_highlight"
                            groups="product_configure.group_finance_account_head" data-hotkey="x"/>
                    <!-- Receipt Unit Approval Stage 3 By GM/AGM -->
                    <!-- <button name="action_approve_gm_agm" attrs="{'invisible': ['|','|',('is_return','=',True),('picking_type_code', '!=', 'incoming'),('state', '!=', 'approve_finance_head')]}" string="Approve By GM/AGM" type="object" class="oe_highlight" groups="product_configure.group_gm_agm" data-hotkey="x" /> -->
                    <!-- Internal Transfer Part/Unit Approval Stage 1 By Inventory Head -->
                    <button name="action_approve_inv_head"
                            attrs="{'invisible': ['|','|','|',('bu_br_user_approve','=',False),('show_check_availability','!=',False),('picking_type_code', '!=','internal'),('state', 'not in', ['waiting','confirmed','assigned'])]}"
                            string="Approve By Inventory Head" type="object" class="oe_highlight"
                            groups="product_configure.group_inventory_head" data-hotkey="x"/>
                    <!-- Internal Transfer Unit Approval Stage 2 By Finance Head -->
                    <button name="action_approve_finance_head"
                            attrs="{'invisible': ['|','|','|','|',('bu_br_user_approve','=',False),('unit_or_part','!=','unit'),('picking_type_code', '!=','internal'),('show_check_availability','!=',False),('state', '!=', 'approve_inv_head')]}"
                            string="Approve By F &amp; A Head" type="object" class="oe_highlight"
                            groups="product_configure.group_finance_account_head" data-hotkey="x"/>
                    <field name="is_return" invisible='1'></field>
                    <!-- Return Part/Unit Approval Stage 1 By Inventory Head -->
                    <button name="action_approve_inv_head"
                            attrs="{'invisible': ['|','|','|',('bu_br_user_approve','=',False),('show_check_availability','!=',True),('is_return', '=',False),('state', 'not in', ['waiting','confirmed','assigned'])]}"
                            string="Approve By Inventory Head" type="object" class="oe_highlight"
                            groups="product_configure.group_inventory_head" data-hotkey="x"/>
                    <!-- Return Unit/Part Approval Stage 2 By Finance Head -->
                    <button name="action_approve_finance_head"
                            attrs="{'invisible': ['|','|','|',('bu_br_user_approve','=',False),('is_return','!=',True),('show_check_availability','!=',False),('state', '!=', 'approve_inv_head')]}"
                            string="Approve By F &amp; A Head" type="object" class="oe_highlight"
                            groups="product_configure.group_finance_account_head" data-hotkey="x"/>
                    <!-- Return Unit/Part Approval Stage 3 By GM/AGM -->
                    <button name="action_approve_gm_agm"
                            attrs="{'invisible': ['|','|',('bu_br_user_approve','=',False),('is_return','!=',True),('state', '!=', 'approve_finance_head')]}"
                            string="Approve By GM/AGM" type="object" class="oe_highlight"
                            groups="product_configure.group_gm_agm" data-hotkey="x"/>
                </xpath>
                <xpath expr="//button[@name='button_validate']" position="replace">
                    <!-- Receipt/Issue/Internal Transfer Part Confirm -->
                    <button name="button_new_validate"
                            attrs="{'invisible': ['|', '|','|','|',('is_return','=',True),('state', '!=', 'approve_inv_head'),('unit_or_part','!=','part'), ('show_validate', '=', False),('is_validate','=',False)]}"
                            string="Validate" type="object" class="oe_highlight" groups="stock.group_stock_user"
                            data-hotkey="v"/>
                    <!-- Receipt/Issue Unit Confirm -->
                    <button name="button_new_validate"
                            attrs="{'invisible': ['|', '|','|','|','|',('is_return','=',True),('picking_type_code', 'not in',['incoming','outgoing']),('state', '!=', 'approve_finance_head'),('unit_or_part','!=','unit'), ('show_validate', '=', False),('is_validate','=',False)]}"
                            string="Validate" type="object" class="oe_highlight" groups="stock.group_stock_user"
                            data-hotkey="v"/>
                    <!-- Internal Transfer Unit Only Confirm -->
                    <button name="button_new_validate"
                            attrs="{'invisible': ['|',('picking_type_code', '!=','internal'),('state', '!=', 'approve_finance_head')]}"
                            string="Validate" type="object" class="oe_highlight" groups="stock.group_stock_user"
                            data-hotkey="x"/>
                    <!-- <button name="button_new_validate" attrs="{'invisible': ['|','|', ('state', 'not in', ['waiting', 'confirmed','assigned']), ('show_validate', '=', False),('is_validate','=',False)]}" string="Validate" type="object" groups="stock.group_stock_user" class="o_btn_validate" data-hotkey="v" /> -->
                    <!-- Return Validate Part/Unit -->
                    <button name="button_new_validate"
                            attrs="{'invisible': ['|',('is_return','!=',True),('state', '!=', 'approve_gm_agm')]}"
                            string="Validate" type="object" class="oe_highlight" groups="stock.group_stock_user"
                            data-hotkey="x"/>
                </xpath>
                <field name="origin" position="after">
                    <field name="hr_bu_id" options="{'no_create_edit': True}"/>
                    <field name="hr_br_id" options="{'no_create_edit': True}"/>
                    <field name="unit_or_part"/>
                </field>
                <field name="product_uom" position="after">
                    <field name="hr_bu_id" invisible="1"/>
                    <field name="hr_br_id" invisible="1"/>
                </field>
                <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_id']"
                       position="attributes">
                    <attribute name="options">{'no_create': True}</attribute>
                </xpath>
            </field>
        </record>
        <record id="stock_picking_tree_inherit" model="ir.ui.view">
            <field name="name">stock.picking</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.vpicktree"/>
            <field name="arch" type="xml">
				<xpath expr="//field[@name='location_dest_id']" position="after">
					<field name="hr_bu_id"/>
					<field name="hr_br_id"/>
				</xpath>
            </field>
        </record>

        <record id="stock.action_picking_tree_all" model="ir.actions.act_window">
            <field name="name">Transfers</field>
            <field name="res_model">stock.picking</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_mode">tree,kanban,form,calendar</field>
            <field name="domain">[('picking_type_id.hr_bu_id','in', c_b_ids)]</field>
            <field name="context">{'contact_display': 'partner_address', 'default_company_id': allowed_company_ids[0]}</field>
            <field name="search_view_id" ref="stock.view_picking_internal_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No transfer found. Let's create one!
                </p><p>
                    Transfers allow you to move products from one location to another.
                </p>
            </field>
        </record>

    </data>
</odoo>
